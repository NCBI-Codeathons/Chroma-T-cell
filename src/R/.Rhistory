dts <- NULL
for(i in 2:3){
dt <- data.table(t(combn(features,i)))
keep <- c()
for(j in 1:nrow(dt)){
if(nrow(m[,c(dt[j] %>% unlist %>% unname),with=F] %>% na.omit())>10){
keep <- c(keep,i)
}
}
dts[[i]] <- dt[keep]
}
dts
N <- 50
dts <- NULL
for(i in 1::3){
N <- 50
dts <- NULL
for(i in 1:3){
dt <- data.table(t(combn(features,i)))
keep <- c()
for(j in 1:nrow(dt)){
if(nrow(m[,c(dt[j] %>% unlist %>% unname),with=F] %>% na.omit())>N){
keep <- c(keep,i)
}
}
dts[[i]] <- dt[keep]
}
dts
N <- 50
dts <- NULL
for(i in 1:4){
dt <- data.table(t(combn(features,i)))
keep <- c()
for(j in 1:nrow(dt)){
if(nrow(m[,c(dt[j] %>% unlist %>% unname),with=F] %>% na.omit())>N){
keep <- c(keep,i)
}
}
dts[[i]] <- dt[keep]
}
dts
N <- 500
dts <- NULL
for(i in 1:4){
dt <- data.table(t(combn(features,i)))
keep <- c()
for(j in 1:nrow(dt)){
if(nrow(m[,c(dt[j] %>% unlist %>% unname),with=F] %>% na.omit())>N){
keep <- c(keep,i)
}
}
dts[[i]] <- dt[keep]
}
dts
N <- 700
dts <- NULL
for(i in 1:4){
dt <- data.table(t(combn(features,i)))
keep <- c()
for(j in 1:nrow(dt)){
if(nrow(m[,c(dt[j] %>% unlist %>% unname),with=F] %>% na.omit())>N){
keep <- c(keep,i)
}
}
dts[[i]] <- dt[keep]
}
dts
features <- data.table(t(data.table(datatype_mccv_significant_results[
type=="measurements","term"])))
nboot=200
system.time(
mult_out <- pairwise_func(m,nboot,features,replace = F)
)
mult_out$fimps[,
.(
estimate_lwr = quantile(estimate,probs=c(0.025),na.rm=T)[1],
estimate_mean = mean(estimate,na.rm=T),
estimate_upr = quantile(estimate,probs=c(0.975),na.rm=T)[1]
),
term
][
estimate_lwr>0 | estimate_upr<0
] %>%
merge(
datatype_mccv_significant_results[,
.(term,name)
] %>%
unique()
)
nboot=200
system.time(
mult_aalen_out <- pairwise_aalen_func(m,nboot,features,replace = F,status_name="event")
)
dats <- mult_aalen_out$aalen_data %>%
filter(variable!="Intercept" & time!=0 & time<=14) %>%
filter(is.finite(value)) %>%
group_by(time,variable) %>%
summarise(
lwr = quantile(value,probs=c(0.025))[1],
mean = mean(value),
upr = quantile(value,probs=c(0.975))[1]
) %>%
ungroup() %>%
mutate(
odds_lwr = exp(lwr),
odds_mean = exp(mean),
odds_upr = exp(upr)
) %>%
filter(is.finite(odds_mean) & is.finite(mean)) %>%
arrange(time) %>%
group_by(variable) %>%
mutate(
cumrisk_lwr = cumsum(odds_lwr),
cumrisk_mean = cumsum(odds_mean),
cumrisk_upr = cumsum(odds_upr)
) %>%
ungroup() %>%
left_join(
concept_map,
by=c("variable"="predictor")
) %>%
data.table()
dats[lwr>0 | upr<0] %>%
dcast(concept_name ~ time,value.var="mean")
library(RTCGA)
library(RTCGA.clinical)
RTCGA.clinical::BRCA.clinical
library(RTCGA.mutations)
brca_clinical_dt <- RTCGA.clinical::BRCA.clinical %>% data.table()
library(tidyverse)
library(data.table)
brca_clinical_dt <- RTCGA.clinical::BRCA.clinical %>% data.table()
brca_clinical_dt
brca_clinical_dt <-
RTCGA.clinical::BRCA.clinical %>%
data.table() %>%
melt()
brca_clinical_dt
brca_clinical_dt <-
RTCGA.clinical::BRCA.clinical %>%
data.table()
brca_clinical_dt_wide <-
RTCGA.clinical::BRCA.clinical %>%
data.table()
colnames(brca_clinical_dt_wide)
colnames(brca_clinical_dt_wide) %>% View()
brca_clinical_dt_wide[,lapply(.SD,unique)]
brca_clinical_dt_wide[,lapply(.SD,unique)] %>% View()
brca_clinical_dt_wide[,lapply(.SD,function(x){length(unique(x))}] %>% View()
brca_clinical_dt_wide[,lapply(.SD,function(x){length(unique(x))})] %>% View()
nunique_for_columns <-
brca_clinical_dt_wide[,lapply(.SD,function(x){length(unique(x))})]
nunique_for_columns[order(nunique_for_columns)]
head(nunique_for_columns[order(nunique_for_columns)])
nunique_for_columns[order(nunique_for_columns)][1:5]
nunique_for_columns[order(nunique_for_columns)][,1:5]
order(nunique_for_columns)
nunique_for_columns[order(nunique_for_columns)][,1:5]
colnames(nunique_for_columns)[order(nunique_for_columns)][1:5]
brca_clinical_dt_wide[,colnames(nunique_for_columns)[order(nunique_for_columns)][1:5],with=F]
brca_clinical_dt_wide[,colnames(nunique_for_columns)[order(nunique_for_columns)][3698:3703],with=F]
brca_clinical_dt_wide %>% melt()
brca_clinical_dt_wide[,colnames(nunique_for_columns)[order(nunique_for_columns)][3698:3703],with=F]
brca_clinical_dt_wide %>% melt(id.vars=c("patient.samples.sample.bcr_sample_uuid"))
brca_clinical_dt_wide$row_id <-
1:nrow(brca_clinical_dt_wide)
brca_clinical_dt_long <-
brca_clinical_dt_wide %>%
melt(id.vars=c("row_id"))
brca_clinical_dt_long
str_split(brca_clinical_dt_long$variable,"\\.")
split_variable_names <-
str_split(brca_clinical_dt_long$variable,"\\.")
split_variable_names
split_variable_names <-
str_split(unique(brca_clinical_dt_long$variable),"\\.")
split_variable_names
brca_clinical_dt_long[,.(split_variable = list(str_split(variable,"\\.")))]
brca_clinical_dt_long[,
.(split_variable = list(str_split(variable,"\\."))),
.(row_id,value)
]
brca_clinical_dt_long <-
brca_clinical_dt_wide %>%
melt(id.vars=c("row_id")) %>%
na.omit()
brca_clinical_dt_long[,
.(split_variable = list(str_split(variable,"\\."))),
.(row_id,value)
]
brca_clinical_dt_long[,
.(split_variable = list(str_split(variable,"\\."))),
.(row_id,variable,value)
]
brca_clinical_dt_long_wsplit <-
brca_clinical_dt_long[,
.(split_variable = list(str_split(variable,"\\."))),
.(row_id,variable,value)
]
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(split_variable = str_replace_all(variable,"\\.","_")),
.(row_id,variable,value)
]
brca_clinical_dt_long_snake_case
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(snake_case_variable = str_replace_all(variable,"\\.","_")),
.(row_id,value)
]
brca_clinical_dt_long_snake_case
brca_clinical_dt_long_snack_case_wide <-
brca_clinical_dt_long_snake_case %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_clinical_dt_long_snack_case_wide
brca_clinical_dt_long_snack_case_wide[1:5,1:5]
RTCGA.mutations::BRCA.mutations
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(snake_case_variable = str_to_lower(v) %>% str_replace_all("\\.","_")),
.(row_id,value)
]
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(snake_case_variable = str_to_lower(variable) %>% str_replace_all("\\.","_")),
.(row_id,value)
]
brca_clinical_dt_long_snack_case_wide <-
brca_clinical_dt_long_snake_case %>%
dcast(row_id ~ snake_case_variable,value.var="value")
RTCGA.mutations::BRCA.mutations
brca_mutation_dt_wide <-
RTCGA.mutations::BRCA.mutations %>%
data.table()
brca_mutation_dt_wide$row_id <-
1:nrow(brca_mutation_dt_wide)
brca_mutation_dt_long <-
brca_mutation_dt_wide %>%
melt(id.vars=c("row_id")) %>%
na.omit()
brca_mutation_dt_long
brca_mutation_dt_long_snake_case <-
brca_mutation_dt_long[,
.(snake_case_variable = str_to_lower(variable)),
.(row_id,value)
]
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snack_case_wide %>% t() %>% data.table()
brca_mutation_dt_long_snack_case_wide_transpose <-
brca_mutation_dt_long_snack_case_wide %>%
t() %>%
data.table()
dim(brca_mutation_dt_long_snack_case_wide_transpose)
brca_mutation_dt_long_snack_case_wide_transpose[1:5,1:5]
brca_mutation_dt_long_snack_case_wide
colnames(brca_mutation_dt_long_snack_case_wide)
brca_mutation_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_mutation_dt_long_snack_case_wide)
brca_mutation_dt_long_snack_case_wide_transpose
x <- "column_name"
brca_mutation_dt_long_snack_case_wide_transpose[,c(x,paste0("V",1:ncol(brca_mutation_dt_long_snack_case_wide_transpose)))]
brca_mutation_dt_long_snack_case_wide_transpose_reorder <-
brca_mutation_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",1:ncol(brca_mutation_dt_long_snack_case_wide_transpose))),
with=F]
brca_mutation_dt_long_snack_case_wide_transpose_reorder <-
brca_mutation_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",
1:ncol(brca_mutation_dt_long_snack_case_wide_transpose)-1)),
with=F]
brca_mutation_dt_long_snack_case_wide_transpose_reorder <-
brca_mutation_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",
1:(ncol(brca_mutation_dt_long_snack_case_wide_transpose)-1))
),
with=F]
brca_mutation_dt_long_snack_case_wide_transpose_reorder
x <- "column_name"
brca_clinical_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_clinical_dt_long_snack_case_wide)
brca_clinical_dt_long_snack_case_wide_transpose <-
brca_clinical_dt_long_snack_case_wide %>%
t() %>%
data.table()
x <- "column_name"
brca_clinical_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_clinical_dt_long_snack_case_wide)
brca_clinical_dt_long_snack_case_wide_transpose_reorder <-
brca_clinical_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",
1:(ncol(brca_clinical_dt_long_snack_case_wide_transpose)-1))
),
with=F]
brca_clinical_dt_long_snack_case_wide_transpose_reorder[1:5,1:5]
dim(brca_clinical_dt_long_snack_case_wide_transpose_reorder)
brca_clinical_dt_long_snack_case_wide_transpose_reorder <-
brca_clinical_dt_long_snack_case_wide_transpose[column_name!="row_id",
c(x,paste0("V",
1:(ncol(brca_clinical_dt_long_snack_case_wide_transpose)-1))
),
with=F]
brca_mutation_dt_long_snack_case_wide_transpose_reorder <-
brca_mutation_dt_long_snack_case_wide_transpose[column_name!="row_id",
c(x,paste0("V",
1:(ncol(brca_mutation_dt_long_snack_case_wide_transpose)-1))
),
with=F]
dim(brca_mutation_dt_long_snack_case_wide_transpose_reorder)
source('~/GitHub/OMOPOmics/src/R/Case_study_TCGA.R')
dim(brca_mutation_dt_long_snack_case_wide_transpose_reorder)
dim(brca_clinical_dt_long_snack_case_wide_transpose_reorder)
brca_clinical_dt_long_snack_case_wide_transpose_reorder
brca_clinical_dt_long_snack_case_wide_transpose_reorder[1:5,1:5]
brca_clinical_dt_long_snack_case_wide_transpose_reorder[1:50,1:5]
brca_clinical_dt_long_snack_case_wide_transpose_reorder %>%
fwrite("RTCGA_data/brca_clinical.csv")
setwd("~/GitHub/OMOPOmics/src/R")
brca_clinical_dt_long_snack_case_wide_transpose_reorder %>%
fwrite("RTCGA_data/brca_clinical.csv")
brca_mutation_dt_long
brca_mutation_dt_long_snake_case$snake_case_variable
unique()brca_mutation_dt_long_snake_case$snake_case_variable)
brca_mutation_dt_long_snake_case$snake_case_variable %>% brca_mutation_dt_long_snake_case
brca_mutation_dt_long_snake_case$snake_case_variable %>% unique()
brca_mutation_dt_long_snake_case$snake_case_variable %>% unique()
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
,c("bcr_patient_barcode","tumor_sample_barcode","matched_norm_sample_barcode"),
with=F
] %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snake_case
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("bcr_patient_barcode","tumor_sample_barcode","matched_norm_sample_barcode")
] %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("bcr_patient_barcode","tumor_sample_barcode","matched_norm_sample_barcode")
] %>%
unique() %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("bcr_patient_barcode","tumor_sample_barcode","matched_norm_sample_barcode")
] %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide_transpose <-
brca_mutation_dt_long_snack_case_wide %>%
t() %>%
data.table()
x <- "column_name"
brca_mutation_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_mutation_dt_long_snack_case_wide)
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snack_case_wide_transpose
brca_mutation_dt_wide <-
RTCGA.mutations::BRCA.mutations %>%
data.table()
brca_mutation_dt_long <-
brca_mutation_dt_wide %>%
melt(id.vars=c("bcr_patient_barcode")) %>%
na.omit()
brca_mutation_dt_long
brca_mutation_dt_long_snake_case <-
brca_mutation_dt_long[,
.(snake_case_variable = str_to_lower(variable)),
.(bcr_patient_barcode,value)
]
brca_mutation_dt_long_snake_case$snake_case_variable %>% unique()
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_barcode","matched_norm_sample_barcode")
] %>%
dcast(row_id ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_barcode","matched_norm_sample_barcode")
] %>%
dcast(bcr_patient_barcode ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide
brca_clinical_dt_long_snack_case_wide_transpose_reorder
brca_clinical_dt_long_snack_case_wide_transpose_reorder$column_name
intersect(brca_clinical_dt_long_snack_case_wide_transpose_reorder$column_name,colnames(brca_mutation_dt_wide))
colnames(brca_mutation_dt_wide)
grep("barcode",brca_clinical_dt_long_snack_case_wide_transpose_reorder$column_name)
brca_clinical_dt_long_snack_case_wide_transpose_reorder$column_name[grep("barcode",brca_clinical_dt_long_snack_case_wide_transpose_reorder$column_name)]
brca_clinical_dt_wide <-
RTCGA.clinical::BRCA.clinical %>%
data.table()
brca_clinical_dt_long <-
brca_clinical_dt_wide %>%
melt(id.vars=c("patient_bcr_patient_barcode")) %>%
na.omit()
brca_clinical_dt_long <-
brca_clinical_dt_wide %>%
melt(id.vars=c("patient.bcr.patient.barcode")) %>%
na.omit()
brca_clinical_dt_wide
brca_clinical_dt_wide[,c(patient.bcr_patient_barcode)]
brca_clinical_dt_long <-
brca_clinical_dt_wide %>%
melt(id.vars=c("patient.bcr_patient_barcode")) %>%
na.omit()
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(snake_case_variable = str_to_lower(variable) %>% str_replace_all("\\.","_")),
.(row_id,value)
]
# With the above I'd now like to make it snake case and get rid of those periods
brca_clinical_dt_long_snake_case <-
brca_clinical_dt_long[,
.(snake_case_variable = str_to_lower(variable) %>% str_replace_all("\\.","_")),
.(patient.bcr_patient_barcode,value)
]
brca_clinical_dt_long_snack_case_wide <-
brca_clinical_dt_long_snake_case %>%
dcast(patient.bcr_patient_barcode ~ snake_case_variable,value.var="value")
brca_clinical_dt_long_snack_case_wide
brca_clinical_dt_long_snack_case_wide_transpose <-
brca_clinical_dt_long_snack_case_wide %>%
t() %>%
data.table()
x <- "column_name"
brca_clinical_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_clinical_dt_long_snack_case_wide)
brca_clinical_dt_long_snack_case_wide_transpose_reorder <-
brca_clinical_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",
1:(ncol(brca_clinical_dt_long_snack_case_wide_transpose)-1))
),
with=F]
brca_clinical_dt_long_snack_case_wide_transpose_reorder[1:50,1:5]
dim(brca_clinical_dt_long_snack_case_wide_transpose_reorder)
brca_clinical_dt_long_snack_case_wide_transpose_reorder %>%
fwrite("RTCGA_data/brca_clinical.csv")
brca_mutation_dt_wide <-
RTCGA.mutations::BRCA.mutations %>%
data.table()
brca_mutation_dt_long <-
brca_mutation_dt_wide %>%
melt(id.vars=c("bcr_patient_barcode")) %>%
na.omit()
brca_mutation_dt_long_snake_case <-
brca_mutation_dt_long[,
.(snake_case_variable = str_to_lower(variable)),
.(bcr_patient_barcode,value)
]
brca_mutation_dt_long_snake_case$snake_case_variable %>% unique()
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_uuid")
] %>%
dcast(bcr_patient_barcode ~ snake_case_variable,value.var="value")
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_uuid")
] %>%
dcast(bcr_patient_barcode ~ snake_case_variable,value.var="value",fun.aggregate=unique)
?dcast
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_uuid")
] %>%
dcast(bcr_patient_barcode ~ snake_case_variable,value.var="value",fun.aggregate=functtion(x){x[1]})
brca_mutation_dt_long_snack_case_wide <-
brca_mutation_dt_long_snake_case[
snake_case_variable %in%
c("tumor_sample_uuid")
] %>%
dcast(bcr_patient_barcode ~ snake_case_variable,value.var="value",fun.aggregate=function(x){x[1]})
brca_mutation_dt_long_snack_case_wide
brca_mutation_dt_long_snack_case_wide_transpose <-
brca_mutation_dt_long_snack_case_wide %>%
t() %>%
data.table()
x <- "column_name"
brca_mutation_dt_long_snack_case_wide_transpose$column_name <-
colnames(brca_mutation_dt_long_snack_case_wide)
brca_mutation_dt_long_snack_case_wide_transpose_reorder <-
brca_mutation_dt_long_snack_case_wide_transpose[,
c(x,paste0("V",
1:(ncol(brca_mutation_dt_long_snack_case_wide_transpose)-1))
),
with=F]
brca_mutation_dt_long_snack_case_wide_transpose_reorder
dim(brca_mutation_dt_long_snack_case_wide_transpose_reorder)
brca_mutation_dt_long_snack_case_wide_transpose_reorder[1:5,1:5]
brca_mutation_dt_long_snack_case_wide_transpose_reorder[1:2,1:5]
brca_mutation_dt_long_snack_case_wide_transpose_reorder %>%
fwrite("RTCGA_data/brca_mutation.csv")
source('~/GitHub/OMOPOmics/src/R/Case_study_TCGA.R')
